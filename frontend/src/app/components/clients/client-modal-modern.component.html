<!-- Modern Modal Overlay -->
<div class="modal-overlay-modern" *ngIf="isVisible" (click)="onOverlayClick($event)" [@fadeIn]>
  
  <!-- Modal Container -->
  <div class="modal-container-modern" [@slideUp] (click)="$event.stopPropagation()">
    
    <!-- Modal Header -->
    <div class="modal-header-modern">
      <div class="header-title-section">
        <div class="modal-icon">
          <i class="pi" [class.pi-plus]="isCreating" [class.pi-pencil]="!isCreating"></i>
        </div>
        <div class="title-content">
          <h2 class="modal-title">
            {{ isCreating ? 'Nuevo Cliente' : 'Editar Cliente' }}
          </h2>
          <p class="modal-subtitle">
            {{ isCreating ? 'Ingresa la información del nuevo cliente' : 'Modifica los datos del cliente' }}
          </p>
        </div>
      </div>
      
      <button class="close-btn-modern" (click)="close()" title="Cerrar">
        <i class="pi pi-times"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body-modern">
      <form class="client-form-modern" [formGroup]="clientForm" (ngSubmit)="onSubmit()">
        
        <!-- Photo Upload Section -->
        <div class="form-section photo-section">
          <div class="photo-upload-container">
            <div class="avatar-preview">
              <img 
                [src]="avatarPreview || defaultAvatar" 
                alt="Avatar del cliente"
                class="avatar-image-large">
              <div class="photo-overlay">
                <i class="pi pi-camera"></i>
                <span>Cambiar foto</span>
              </div>
              <input 
                type="file" 
                accept="image/*" 
                (change)="onPhotoSelect($event)"
                class="photo-input"
                #photoInput>
            </div>
            <div class="photo-actions">
              <button type="button" class="btn btn-secondary btn-sm" (click)="photoInput.click()">
                <i class="pi pi-upload"></i>
                Subir foto
              </button>
              <button 
                type="button" 
                class="btn btn-secondary btn-sm" 
                (click)="removePhoto()"
                *ngIf="avatarPreview">
                <i class="pi pi-trash"></i>
                Eliminar
              </button>
            </div>
          </div>
        </div>

        <!-- Personal Information -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="pi pi-user section-icon"></i>
            Información Personal
          </h3>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label-modern">
                Nombre Completo *
              </label>
              <div class="input-container">
                <i class="pi pi-user input-icon"></i>
                <input 
                  type="text" 
                  class="form-input-modern"
                  formControlName="name"
                  placeholder="Ingresa el nombre completo"
                  [class.error]="isFieldInvalid('name')">
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('name')">
                El nombre es requerido
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Tipo de Documento
              </label>
              <div class="input-container">
                <i class="pi pi-id-card input-icon"></i>
                <select class="form-input-modern" formControlName="documentType">
                  <option value="">Seleccionar tipo</option>
                  <option value="cc">Cédula de Ciudadanía</option>
                  <option value="ti">Tarjeta de Identidad</option>
                  <option value="ce">Cédula de Extranjería</option>
                  <option value="pp">Pasaporte</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Número de Documento
              </label>
              <div class="input-container">
                <i class="pi pi-hashtag input-icon"></i>
                <input 
                  type="text" 
                  class="form-input-modern"
                  formControlName="documentNumber"
                  placeholder="Número de documento">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Fecha de Nacimiento
              </label>
              <div class="input-container">
                <i class="pi pi-calendar input-icon"></i>
                <input 
                  type="date" 
                  class="form-input-modern"
                  formControlName="birthDate">
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="pi pi-phone section-icon"></i>
            Información de Contacto
          </h3>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label-modern">
                Email *
              </label>
              <div class="input-container">
                <i class="pi pi-envelope input-icon"></i>
                <input 
                  type="email" 
                  class="form-input-modern"
                  formControlName="email"
                  placeholder="ejemplo@correo.com"
                  [class.error]="isFieldInvalid('email')">
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('email')">
                <span *ngIf="clientForm.get('email')?.errors?.['required']">El email es requerido</span>
                <span *ngIf="clientForm.get('email')?.errors?.['email']">El formato del email es inválido</span>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Teléfono *
              </label>
              <div class="input-container">
                <i class="pi pi-phone input-icon"></i>
                <input 
                  type="tel" 
                  class="form-input-modern"
                  formControlName="phone"
                  placeholder="+57 300 123 4567"
                  [class.error]="isFieldInvalid('phone')">
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('phone')">
                El teléfono es requerido
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Teléfono Alternativo
              </label>
              <div class="input-container">
                <i class="pi pi-phone input-icon"></i>
                <input 
                  type="tel" 
                  class="form-input-modern"
                  formControlName="alternativePhone"
                  placeholder="+57 301 123 4567">
              </div>
            </div>

            <div class="form-group full-width">
              <label class="form-label-modern">
                Dirección *
              </label>
              <div class="input-container">
                <i class="pi pi-map-marker input-icon"></i>
                <input 
                  type="text" 
                  class="form-input-modern"
                  formControlName="address"
                  placeholder="Calle 123 # 45-67, Barrio, Ciudad"
                  [class.error]="isFieldInvalid('address')">
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('address')">
                La dirección es requerida
              </div>
            </div>
          </div>
        </div>

        <!-- Additional Information -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="pi pi-info-circle section-icon"></i>
            Información Adicional
          </h3>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label-modern">
                Estado
              </label>
              <div class="toggle-group">
                <label class="toggle-option">
                  <input 
                    type="radio" 
                    name="status" 
                    value="ACTIVE" 
                    formControlName="status"
                    class="toggle-input">
                  <span class="toggle-label success">
                    <i class="pi pi-check"></i>
                    Activo
                  </span>
                </label>
                <label class="toggle-option">
                  <input 
                    type="radio" 
                    name="status" 
                    value="INACTIVE" 
                    formControlName="status"
                    class="toggle-input">
                  <span class="toggle-label danger">
                    <i class="pi pi-times"></i>
                    Inactivo
                  </span>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Cliente VIP
              </label>
              <div class="checkbox-container">
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    formControlName="isVip"
                    class="checkbox-input">
                  <span class="checkbox-custom">
                    <i class="pi pi-check"></i>
                  </span>
                  <span class="checkbox-text">
                    Marcar como cliente VIP
                    <small>Los clientes VIP reciben descuentos especiales</small>
                  </span>
                </label>
              </div>
            </div>

            <div class="form-group full-width">
              <label class="form-label-modern">
                Notas y Observaciones
              </label>
              <div class="input-container">
                <i class="pi pi-file-edit input-icon textarea-icon"></i>
                <textarea 
                  class="form-textarea-modern"
                  formControlName="notes"
                  placeholder="Información adicional sobre el cliente (opcional)"
                  rows="3"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Emergency Contact -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="pi pi-users section-icon"></i>
            Contacto de Emergencia
            <span class="optional-label">Opcional</span>
          </h3>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label-modern">
                Nombre del Contacto
              </label>
              <div class="input-container">
                <i class="pi pi-user input-icon"></i>
                <input 
                  type="text" 
                  class="form-input-modern"
                  formControlName="emergencyContactName"
                  placeholder="Nombre completo">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Teléfono del Contacto
              </label>
              <div class="input-container">
                <i class="pi pi-phone input-icon"></i>
                <input 
                  type="tel" 
                  class="form-input-modern"
                  formControlName="emergencyContactPhone"
                  placeholder="+57 300 123 4567">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label-modern">
                Relación
              </label>
              <div class="input-container">
                <i class="pi pi-heart input-icon"></i>
                <select class="form-input-modern" formControlName="emergencyContactRelation">
                  <option value="">Seleccionar relación</option>
                  <option value="spouse">Cónyuge</option>
                  <option value="parent">Padre/Madre</option>
                  <option value="sibling">Hermano/a</option>
                  <option value="child">Hijo/a</option>
                  <option value="friend">Amigo/a</option>
                  <option value="other">Otro</option>
                </select>
              </div>
            </div>
          </div>
        </div>

      </form>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer-modern">
      <div class="footer-info">
        <i class="pi pi-info-circle"></i>
        Los campos marcados con * son obligatorios
      </div>
      
      <div class="footer-actions">
        <button type="button" class="btn btn-secondary" (click)="close()">
          <i class="pi pi-times"></i>
          Cancelar
        </button>
        
        <button 
          type="button" 
          class="btn btn-primary"
          [disabled]="clientForm.invalid || isLoading"
          (click)="onSubmit()">
          <i class="pi" [class.pi-spin]="isLoading" [class.pi-loading]="isLoading" [class.pi-save]="!isLoading"></i>
          <span *ngIf="!isLoading">{{ isCreating ? 'Crear Cliente' : 'Guardar Cambios' }}</span>
          <span *ngIf="isLoading">{{ isCreating ? 'Creando...' : 'Guardando...' }}</span>
        </button>
      </div>
    </div>

  </div>
</div>