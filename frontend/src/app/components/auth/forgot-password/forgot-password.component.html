<ng-container *ngIf="!panelMode; else panel">
  <div class="auth-page anim-fade-in">
    <!-- Enhanced animated background -->
    <div class="auth-bg anim-fade-in" aria-hidden="true">
      <div class="bg-pattern"></div>
      <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
      </div>
    </div>

    <div class="auth-card anim-slide-down">
      <div class="auth-header">
        <div class="brand">
          <div class="logo">
            <i class="pi pi-lock"></i>
          </div>
          <div class="brand-text">
            <h1>Recuperar Contraseña</h1>
            <p>Te ayudamos a recuperar tu acceso</p>
          </div>
        </div>
        <div class="welcome-badge">
          <i class="pi pi-envelope"></i>
          <span>Recuperación Segura</span>
        </div>
      </div>

      <form class="auth-form anim-fade-in-up" [formGroup]="form" (ngSubmit)="submit()" *ngIf="!sent" novalidate>
        <div class="form-control" [class.invalid]="form.controls.email.invalid && form.controls.email.touched">
          <label for="email">
            <i class="pi pi-envelope"></i>
            Correo Electrónico
          </label>
          <div class="input-wrapper">
            <input id="email" type="email" formControlName="email" placeholder="Ingresa tu correo registrado" />
            <div class="input-highlight"></div>
          </div>
          <small class="hint" *ngIf="form.controls.email.invalid && form.controls.email.touched">
            <i class="pi pi-exclamation-circle"></i>
            Ingresa un email válido
          </small>
        </div>

        <div class="info-message">
          <i class="pi pi-info-circle"></i>
          <span>Enviaremos un enlace de recuperación si el email está registrado en nuestro sistema.</span>
        </div>

        <button class="btn-primary" type="submit" [disabled]="loading">
          <span class="btn-content">
            <i class="pi" [ngClass]="loading ? 'pi-spin pi-spinner' : 'pi-send'"></i>
            <span class="btn-text">{{ loading ? 'Enviando enlace...' : 'Enviar Enlace' }}</span>
          </span>
          <div class="btn-glow"></div>
        </button>

        <div class="auth-footer">
          <a routerLink="/login">
            <i class="pi pi-arrow-left"></i>
            Volver al inicio de sesión
          </a>
        </div>
      </form>

      <div class="success-container anim-fade-in-up" *ngIf="sent">
        <div class="success-icon">
          <i class="pi pi-check-circle"></i>
        </div>
        <h3>¡Correo Enviado!</h3>
        <p>Si existe una cuenta con ese email, recibirás un enlace para restablecer tu contraseña en los próximos minutos.</p>
        <div class="success-actions">
          <button class="btn-primary" type="button" (click)="goToLogin()">
            <span class="btn-content">
              <i class="pi pi-sign-in"></i>
              <span class="btn-text">Ir a Iniciar Sesión</span>
            </span>
            <div class="btn-glow"></div>
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #panel>
  <div class="auth-container">
    <div class="auth-header" style="margin-bottom: 16px;">
      <div class="brand">
        <div class="logo">MP</div>
        <div class="brand-text">
          <h1 style="margin: 0; font-size: 1.25rem;">Recuperar contraseña</h1>
          <p style="margin: 0; color: var(--text-secondary, #6b7280);">Te enviaremos un enlace si tu email está registrado</p>
        </div>
      </div>
    </div>

    <form class="auth-form" [formGroup]="form" (ngSubmit)="submit()" *ngIf="!sent" novalidate>
      <div class="form-control" [class.invalid]="form.controls.email.invalid && form.controls.email.touched">
        <label for="email">Email</label>
        <div class="input-wrapper">
          <i class="pi pi-envelope"></i>
          <input id="email" type="email" formControlName="email" placeholder="tu@email.com" />
        </div>
        <small class="hint" *ngIf="form.controls.email.invalid && form.controls.email.touched">Ingresa un email válido</small>
      </div>

      <button class="btn-primary" type="submit" [disabled]="loading">
        <span class="btn-content">
          <i class="pi pi-send"></i>
          {{ loading ? 'Enviando…' : 'Enviar enlace' }}
        </span>
      </button>
    </form>

    <div class="sent" *ngIf="sent">
      <i class="pi pi-check-circle"></i>
      <h3>Revisa tu correo</h3>
      <p>Si existe una cuenta con ese email, recibirás un enlace para restablecer tu contraseña.</p>
      <button class="btn-primary" type="button" (click)="goToLogin()">
        <span class="btn-content">
          <i class="pi pi-sign-in"></i>
          Ir a iniciar sesión
        </span>
      </button>
    </div>
  </div>
</ng-template>
